<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Vozac</title>
    <script src="../Scripts/jquery-3.3.1.min.js"></script>
    <script src="../Scripts/jquery.shortcuts.min.js"></script>
    <script src="../Scripts/bootstrap.min.js"></script>
    <link href="../Content/Mapa.css" rel="stylesheet" />
    <link href="../Content/bootstrap.min.css" rel="stylesheet" />
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyALxjn6ZLM3qKDKm_pQ9YuW2P3S9U_c-lg"></script>
    <link href="../Content/Site.css" rel="stylesheet" />
    <script type="text/javascript">
        ////////////////////////////////////////////////////////////////////////////////
        var adresaa;
        var koordinate;
        var adresaa2;
        var koordinate2;

        ///////////////////////////////
        var geocoder = new google.maps.Geocoder();

        function geocodePosition(pos) {
            geocoder.geocode({
                latLng: pos
            }, function (responses) {
                if (responses && responses.length > 0) {
                    updateMarkerAddress(responses[0].formatted_address);
                } else {
                    updateMarkerAddress('Cannot determine address at this location.');
                }
            });
        }

        function updateMarkerStatus(str) { }

        function updateMarkerPosition(latLng) {
            document.getElementById('info').innerHTML = [
                latLng.lat(),
                latLng.lng()
            ].join(', ');
            koordinate = document.getElementById('info').innerHTML;
        }

        function updateMarkerAddress(str) {
            document.getElementById('address').innerHTML = str;
            adresaa = str;
        }

        function initialize() {
            var latLng = new google.maps.LatLng(45.2407607, 19.8269764);
            var map = new google.maps.Map(document.getElementById('mapCanvas'), {
                zoom: 16,
                center: latLng,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            });
           

            var marker = new google.maps.Marker({
                position: latLng,
                title: 'Point A',
                map: map,
                draggable: true
            });
            navigator.geolocation.getCurrentPosition(function (position) {
                var pos = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };
                
            });

            // Update current position info.
            updateMarkerPosition(latLng);
            geocodePosition(latLng);

            // Add dragging event listeners.
            google.maps.event.addListener(marker, 'dragstart', function () {
                updateMarkerAddress('Dragging...');
            });

            google.maps.event.addListener(marker, 'drag', function () {
                updateMarkerStatus('Dragging...');
                updateMarkerPosition(marker.getPosition());
            });

            google.maps.event.addListener(marker, 'dragend', function () {
                updateMarkerStatus('Drag ended');
                geocodePosition(marker.getPosition());
            });
        }

        google.maps.event.addDomListener(window, 'load', initialize);
        /////////////////////////////////////////////////////////////////////////
        ///////////////////////////////
        var geocoder2 = new google.maps.Geocoder();

        function geocodePosition2(pos) {
            geocoder2.geocode({
                latLng: pos
            }, function (responses) {
                if (responses && responses.length > 0) {
                    updateMarkerAddress2(responses[0].formatted_address);
                } else {
                    updateMarkerAddress2('Cannot determine address at this location.');
                }
            });
        }

        function updateMarkerStatus2(str) { }

        function updateMarkerPosition2(latLng) {
            document.getElementById('info2').innerHTML = [
                latLng.lat(),
                latLng.lng()
            ].join(', ');
            koordinate2 = document.getElementById('info2').innerHTML;
        }

        function updateMarkerAddress2(str) {
            document.getElementById('address2').innerHTML = str;
            adresaa2 = str;
        }

        function initialize2() {
            var latLng2 = new google.maps.LatLng(45.2407607, 19.8269764);
            var map2 = new google.maps.Map(document.getElementById('mapCanvas2'), {
                zoom: 16,
                center: latLng2,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            });


            var marker2 = new google.maps.Marker({
                position: latLng2,
                title: 'Point A',
                map: map2,
                draggable: true
            });
            navigator.geolocation.getCurrentPosition(function (position) {
                var pos = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };

            });

            // Update current position info.
            updateMarkerPosition2(latLng2);
            geocodePosition2(latLng2);

            // Add dragging event listeners.
            google.maps.event.addListener(marker2, 'dragstart', function () {
                updateMarkerAddress('Dragging...');
            });

            google.maps.event.addListener(marker2, 'drag', function () {
                updateMarkerStatus2('Dragging...');
                updateMarkerPosition2(marker2.getPosition());
            });

            google.maps.event.addListener(marker2, 'dragend', function () {
                updateMarkerStatus2('Drag ended');
                geocodePosition2(marker2.getPosition());
            });
        }

        google.maps.event.addDomListener(window, 'load', initialize2);

        function randomIntFromInterval(min, max) {
            return Math.floor(Math.random() * (max - min + 1) + min);
        }
        /////////////////////////////////////////////////////////////////////////
        $(document).ready(function () {
            var id;
            var oldUsername;
            var modal;
            var page = window.location.pathname.split('/');
            if (localStorage.getItem('accessToken') == null) {
                window.location.href = "Login.html";
            }
            else if (localStorage.getItem('mainPage') != page[2]) {
                window.location.href = localStorage.getItem('mainPage');
            }

            $('body').on('click', function () {
                $.ajax({
                    url: '/api/korisnici/getaccess/',
                    method: 'GET',
                    headers: {
                        'Authorization': 'Bearer ' + localStorage.getItem("accessToken")
                    },
                    success: function (response) {

                    },
                    error: function (jqXHR) {

                        $('#errorContent').text(jqXHR.responseJSON.ExceptionMessage);
                        $('#errorModal').modal('show');
                        localStorage.removeItem("accessToken");
                        localStorage.removeItem("mainPage");
                        window.location.href = 'login.html';
                    }
                });
            });

            Mousetrap.bind('shift+r', function () {
                $('#btnRefreshStart').trigger('click');
            });
            Mousetrap.bind('shift+e', function () {
                $('#btnLogoff').trigger('click');
            });
            Mousetrap.bind('shift+w', function () {
                $('#btnLocationStart').trigger('click');
            });

            $('#bntError').click(function () {
                $('#errorModal').modal('hide');
                $('#' + modal).modal('show');
            });

            $('#btnEditStart').click(function () {
                $.ajax({
                    url: '/api/korisnici/getme/',
                    method: 'GET',
                    headers: {
                        'Authorization': 'Bearer ' + localStorage.getItem("accessToken")
                    },
                    success: function (data) {
                        $('#ime').val(data.Ime);
                        $('#prezime').val(data.Prezime);
                        $('#kontaktTelefon').val(data.KontaktTelefon);
                        $('#email').val(data.Email);
                        $('#brojTaksiVozila').val(data.BrojTaksiVozila);
                        $('#godisteAutomobila').val(data.GodisteAutomobila);
                        $('#tipAutomobila').val(data.TipAutomobila);
                        $('#brojRegistarskeOznake').val(data.BrojRegistarskeOznake);
                        oldUsername = data.KorisnickoIme;
                        $('#EditModal').modal('show');
                    }
                });
            });
            $('#btnEdit').click(function () {
                if (!$('#editForm')[0].checkValidity()) {
                    modal = 'EditModal';
                    $('#EditModal').modal('hide');
                    $('#errorContent').text('Unesite ispravne podatke za menjanje podataka');
                    $('#errorModal').modal('show');
                    $(forma).submit();
                }
                $.ajax({
                    url: '/api/Account/EditVozac/',
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer ' + localStorage.getItem("accessToken")
                    },
                    data: {
                        KorisnickoIme: oldUsername,
                        ime: $('#ime').val(),
                        prezime: $('#prezime').val(),
                        kontaktTelefon: $('#kontaktTelefon').val(),
                        email: $('#email').val(),

                        brojTaksiVozila: $('#brojTaksiVozila').val(),
                        godisteAutomobila: $('#godisteAutomobila').val(),
                        tipAutomobila: $('#EtipAutomobila:checked').val(),
                        brojRegistarskeOznake: $('#brojRegistarskeOznake').val()
                    },
                    success: function () {
                        $('#EditModal').modal('hide');
                        $('#successContent').text('Edit Successful!')
                        $('#successModal').modal('show');
                    },
                    error: function (jqXHR) {
                        $('#errorContent').text(jqXHR.responseJSON.Message);
                        $('#errorModal').modal('show');
                        $('#EditModal').modal('hide');
                    }
                });
            });

            $('#btnDetailsStart').click(function () {
                $.ajax({
                    url: '/api/korisnici/getme/',
                    method: 'GET',
                    headers: {
                        'Authorization': 'Bearer ' + localStorage.getItem("accessToken")
                    },
                    success: function (data) {
                        $('#pKorisnickoIme').text(data.KorisnickoIme);
                        $('#pIme').text(data.Ime);
                        $('#pPrezime').text(data.Prezime);
                        $('#pJmbg').text(data.Jmbg);
                        $('#pPol').text(data.Pol);
                        $('#pUloga').text(data.Uloga);

                        $('#pKontaktTelefon').text(data.KontaktTelefon);
                        $('#pEmail').text(data.Email);
                        $('#pLozinka').text(data.Password);

                        $('#pXKoordinata').text(data.XKoordinata);
                        $('#pYKoordinata').text(data.YKoordinata);
                        $('#pUlica').text(data.Ulica);
                        $('#pBroj').text(data.Broj);
                        $('#pGrad').text(data.Grad);
                        $('#pPostanskiBroj').text(data.PostanskiBroj);

                        $('#pBrojTaksiVozila').text(data.BrojTaksiVozila);
                        $('#pGodisteAutomobila').text(data.GodisteAutomobila);
                        $('#pTipAutomobila').text(data.TipAutomobila);


                        $('#pBrojRegistarskeOznake').text(data.BrojRegistarskeOznake);

                        $('#DetailsModal').modal('show');

                    }
                });
            });

            $('#btnLocationStart').click(function () {
                $('#LocationModal').modal('show');
                $('#UnosLokacije').show();
                $('#UnosAdrese').hide();

            });
            $('body').on('click', "input[name='LtipUnosa']", function (data) {
                id = data.target.id;

                if (id == "LunosAdrese") {
                    $('#UnosAdrese').show();
                    $('#UnosLokacije').hide();
                }
                else if (id == "LunosLokacije") {
                    $('#UnosLokacije').show();
                    $('#UnosAdrese').hide();
                }
            });
            $('#btnLocation2').click(function () {
                var broj;
                var ulica = "";
                var grad = "";
                var postanskiBroj;

                var koord = koordinate2.split(',');
                $('#xKoordinata').val(koord[0]);
                $('#yKoordinata').val(koord[1]);

                var delovi = adresaa2.split(',');
                var delovi1 = delovi[0].split(' ');
                if (isNaN(delovi1[delovi1.length - 1])) {
                    for (var i = 0; i < delovi1.length; i++) {
                        ulica += delovi1[i] + " ";
                    }
                    broj = String(randomIntFromInterval(1, 20));
                }
                else {
                    for (var i = 0; i < delovi1.length - 1; i++) {
                        ulica += delovi1[i] + " ";
                    }
                    broj = delovi1[delovi1.length - 1];
                }
                var delovi2 = delovi[1].split(' ');
                if (isNaN(delovi2[delovi2.length - 1])) {
                    for (var i = 1; i < delovi2.length; i++) {
                        grad += delovi2[i] + " ";
                    }
                    postanskiBroj = "21000";
                } else if (delovi2[delovi2.length - 1] > 22000) {
                    for (var i = 1; i < delovi2.length - 1; i++) {
                        grad += delovi2[i] + " ";
                    }
                    postanskiBroj = "21000";
                }
                else {
                    for (var i = 1; i < delovi2.length - 1; i++) {
                        grad += delovi2[i] + " ";
                    }
                    postanskiBroj = delovi2[delovi2.length - 1];
                }

                $('#ulica').val(ulica.trim());
                $('#broj').val(parseInt(broj.trim()));
                $('#grad').val(grad.trim());
                $('#postanskiBroj').val(parseInt(postanskiBroj.trim()));
                $('#btnLocation').trigger('click');
            });
            $('#btnLocation').click(function () {
                if (!$('#locationForm')[0].checkValidity()) {
                    modal = 'LocationModal';
                    $('#LocationModal').modal('hide');
                    $('#errorContent').text('Unesite ispravne podatke za menjanje lokacije');
                    $('#errorModal').modal('show');
                    $(forma).submit();
                }
                $.ajax({
                    url: '/api/korisnici/editlocation/',
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer ' + localStorage.getItem("accessToken")
                    },
                    data: {
                        xKoordinata: $('#xKoordinata').val(),
                        yKoordinata: $('#yKoordinata').val(),
                        ulica: $('#ulica').val(),
                        broj: $('#broj').val(),
                        grad: $('#grad').val(),
                        postanskiBroj: $('#postanskiBroj').val(),
                    },
                    success: function () {
                        $('#LocationModal').modal('hide');
                        $('#successContent').text('Edit Location Successful!')
                        $('#successModal').modal('show');
                    },
                    error: function (jqXHR) {
                        $('#errorContent').text(jqXHR.responseJSON.Message);
                        $('#errorModal').modal('show');
                        $('#LocationModal').modal('hide');
                    }
                });
            });

            $('#btnChangePasswordStart').click(function () {
                $('#changePasswordModal').modal('show');
            });
            $('#btnChangePassword').click(function () {
                if (!$('#change_Form')[0].checkValidity()) {
                    modal = 'changePasswordModal';
                    $('#changePasswordModal').modal('hide');
                    $('#errorContent').text('Unesite ispravne podatke za menjanje lozinke');
                    $('#errorModal').modal('show');
                    $(forma).submit();
                }
                $.ajax({
                    url: '/api/Account/ChangePassword',
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer ' + localStorage.getItem("accessToken")
                    },
                    data: {
                        OldPassword: $('#lozinka1').val(),
                        NewPassword: $('#lozinka2').val(),
                        ConfirmPassword: $('#lozinka3').val()
                    },
                    success: function () {
                        $('#changePasswordModal').modal('hide');
                        $('#successContent').text('Promena je uspesno izvrsena!')
                        $('#successModal').modal('show');
                        $('#btnRefreshStart').trigger("click");
                    },
                    error: function (jqXHR) {
                        $('#errorContent').text(jqXHR.responseJSON.Message);
                        $('#errorModal').modal('show');
                        $('#changePasswordModal').modal('hide');
                    }
                });
            });

            $('#btnLogoff').click(function () {
                localStorage.removeItem('accessToken');
                localStorage.removeItem('mainPage');
                window.location.href = "Login.html";
            });

            $('#btnRefreshStart').click(function () {
                $('#username').text(localStorage.getItem('username'));
                var flag = $('#view:checked').val();
                var statusVoznje = $('#statusVoznje').val();
                var datum = $('#datum:checked').val();
                var ocena = $('#ocena:checked').val();
                var odDatum = $('#Dstart').val();
                var doDatum = $('#Dend').val();
                var odOcena = $('#Ostart').val();
                var doOcena = $('#Oend').val();
                var odCena = $('#Cstart').val();
                var doCena = $('#Cend').val();
                $.ajax({
                    url: '/api/voznje?flaggg=' + flag + '&statusVoznje=' + statusVoznje + '&datum=' + datum + '&ocena=' + ocena + '&odDatum=' + odDatum + '&doDatum=' + doDatum + '&odOcena=' + odOcena + '&doOcena=' + doOcena + '&odCena=' + odCena + '&doCena=' + doCena,
                    method: 'GET',
                    headers: {
                        'Authorization': 'Bearer ' + localStorage.getItem("accessToken")
                    },
                    success: function (data) {
                        $('#divData').removeClass('hidden');
                        $('#tblBody').empty();
                        if (data[0].Flag == 1) {
                            $('#btnLocationStart').hide();
                        }
                        else {
                            $('#btnLocationStart').show();
                        }
                        $.each(data, function (index, value) {
                            if (value.StatusVoznje == "Kreirana_NaCekanju") {
                                var row = $('<tr><td>'
                                    + (index + 1) + '</td><td>'
                                    + value.Polaziste + '</td><td>'
                                    + value.Odrediste + '</td><td>'
                                    + value.KorisnikID + '</td><td>'
                                    + value.DispecerID + '</td><td>'
                                    + value.StatusVoznje + '</td><td>'
                                    + value.DatumIVreme + '</td><td>'
                                    + value.Ocena + '</td><td>'
                                    + value.Iznos + '</td><td>'
                                    + '<input id=' + value.VoznjaID + ' name="BbtnPreuzmi" class="btn btn-success " type = "button" value = "&#x270C;" />'
                                    + '<input id=' + value.VoznjaID + ' name="BbtnDetails" class="btn btn-success" type = "button" value = "&#128270;" />'
                                    + '</td></tr>');
                                $('#tblData').append(row);
                            }
                            else if (value.StatusVoznje != "Neuspesna" && value.StatusVoznje != "Uspesna" && value.StatusVoznje != null) {
                                var row = $('<tr><td>'
                                    + (index + 1) + '</td><td>'
                                    + value.Polaziste + '</td><td>'
                                    + value.Odrediste + '</td><td>'
                                    + value.KorisnikID + '</td><td>'
                                    + value.DispecerID + '</td><td>'
                                    + value.StatusVoznje + '</td><td>'
                                    + value.DatumIVreme + '</td><td>'
                                    + value.Ocena + '</td><td>'
                                    + value.Iznos + '</td><td>'
                                    + '<input id=' + value.VoznjaID + ' name="BbtnUspesnaNeuspesna" class="btn btn-success" placeholder="Uspesna" type = "button"  value = "&#x2714;" />'
                                    + '<input id=' + value.VoznjaID + ' name="BbtnUspesnaNeuspesna" class="btn btn-success"  placeholder="Neuspesna" type = "button" value = "X" />'
                                    + '<input id=' + value.VoznjaID + ' name="BbtnDetails" class="btn btn-success"type = "button" value = "&#128270;" />'
                                    + '</td></tr>');
                                $('#tblData').append(row);
                            }
                            else if (value.StatusVoznje == null) {

                            }
                            else {
                                var row = $('<tr><td>'
                                    + (index + 1) + '</td><td>'
                                    + value.Polaziste + '</td><td>'
                                    + value.Odrediste + '</td><td>'
                                    + value.KorisnikID + '</td><td>'
                                    + value.DispecerID + '</td><td>'
                                    + value.StatusVoznje + '</td><td>'
                                    + value.DatumIVreme + '</td><td>'
                                    + value.Ocena + '</td><td>'
                                    + value.Iznos + '</td><td>'
                                    + '<input id=' + value.VoznjaID + ' name="BbtnDetails" class="btn btn-success"type = "button" value = "&#128270;" />'
                                    + '</td></tr>');
                                $('#tblData').append(row);
                            }
                        });
                    },
                    error: function (data) {
                        alert(data + "fgdfdfdfd");
                    }

                });
            });
            $('body').on('click', "input[name='BbtnDetails']", function (data) {
                id = data.target.id;

                $.ajax({
                    url: '/api/voznje/details/' + id,
                    method: 'GET',
                    headers: {
                        'Authorization': 'Bearer ' + localStorage.getItem("accessToken")
                    },
                    success: function (data) {

                        $('#Dadresa1').val(data.Adresa1);
                        $('#Dadresa2').val(data.Adresa2);
                        $('#DkorisnickoIme').val(data.KorisnickoImeKorisnika);
                        $('#DbrojTaksija').val(data.BrojTaksija);
                        $('#DtipAutomobila').val(data.TipAutomobila);
                        $('#DstatusVoznje').val(data.StatusVoznje);
                        $('#Dopis').val(data.Opis);
                        $('#Docena').val(data.Ocena);
                        $('#Diznos').val(data.Iznos);
                        $('#dVreme').val(data.DatumIVreme);
                        $('#VoznjaDetailsModel').modal('show');
                    },
                });
            });

            $('body').on('click', "input[name='tipUnosa']", function (data) {
                Tid = data.target.id;

                if (Tid == "unosAdrese") {
                    $('#KomentarBody').show();
                    $('#LokacijaBody').hide();
                }
                else if (Tid == "unosLokacije") {
                    $('#LokacijaBody').show();
                    $('#KomentarBody').hide();
                }
            });
            $('body').on('click', "input[name='BbtnUspesnaNeuspesna']", function (data) {
                id = data.target.id;
                $('#unosAdrese').hide();
                $('#unosLokacije').hide();
                $('#LokacijaBody').show();
                $('#KomentarBody').hide();
                status = data.target.placeholder;
                $('#KomentarBody').empty();
                var content;
                if (status == "Uspesna") {
                    $('#LokacijaBody').show();
                    $('#KomentarBody').hide();
                    $('#unosAdrese').show();
                    $('#unosLokacije').show();
                    $('#LabelUnosVoznje').show();
                    $('#LabelUnosLokacije').show();
                    content = '<tr>' +
                        '<td>Ulica</td>' +
                        '<td> <input type="text" id="ulica" name="ulica" placeholder="Ulica" /></td> ' +
                        '</tr><tr> ' +
                        '<td> Broj</td > ' +
                        '<td> <input type="number" id="broj" name="broj" placeholder="Broj" /></td> ' +
                        '</tr><tr> ' +
                        '<td> Grad</td> ' +
                        '<td> <input type="text" id="grad" name="grad" placeholder="Grad" /></td> ' +
                        '</tr><tr> ' +
                        '<td> Postanski Broj</td > ' +
                        '<td> <input type="number" id="postanskiBroj" name="postanskiBroj" placeholder="Postanski Broj" /></td> ' +
                        '</tr>< tr > ' +
                        '<td> Iznos</td> ' +
                        '<td> <input type="number" id="iznos" name="iznos" placeholder="Iznos" /></td> ' +
                        '</tr><tr class="success">' +
                        '<td colspan="2"><input id="btnCommentPost" class="btn btn-success" type="button" value="Postavi" /></td>' +
                        '</tr>';
                }
                else {
                    $('#LokacijaBody').hide();
                    $('#KomentarBody').show();
                    $('#unosAdrese').hide();
                    $('#unosLokacije').hide();
                    $('#LabelUnosVoznje').hide();
                    $('#LabelUnosLokacije').hide();
                    
                    content = '<tr>' +
                        '<td>Opis</td>' +
                        '<td><textarea id="opis" name="Vopis" placeholder="Unesite razlog..." class="form-control" style="min-width: 100%;min-height:150px"></textarea></td>' +
                        '</tr>' +
                        '</tr><tr class="success">' +
                        '<td colspan="2"><input id="btnCommentPost" class="btn btn-success" type="button" value="Postavi" /></td>' +
                        '</tr>';
                }
                $('#KomentarBody').append(content)
                $('#PostKomentarModal').modal('show');

            });
            $('body').on('click', "input[id='btnCommentPost']", function (data) {
                $.ajax({
                    url: '/api/voznje/zavrsena/',
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer ' + localStorage.getItem("accessToken")
                    },
                    data: {
                        Id: id,
                        Status: status,
                        ulica: $('input[name="ulica"]').val(),
                        broj: $('input[name="broj"]').val(),
                        grad: $('input[name="grad"]').val(),
                        postanskiBroj: $('input[name="postanskiBroj"]').val(),
                        Iznos: $('input[name="iznos"]').val(),
                        opis: $('textarea[name="Vopis"]').val(),
                        XKoordinata: $('#xKoordinata').val(),
                        YKoordinata: $('#yKoordinata').val(),
                    },
                    success: function (data) {
                        $('#PostKomentarModal').modal('hide');
                        $('#btnRefreshStart').trigger('click');
                        $('#successContent').text('Voznja zavrsena!')
                        $('#successModal').modal('show');
                    },
                });
            });
            
            $('#btnCommentPost2').click(function () {
                var broj;
                var ulica = "";
                var grad = "";
                var postanskiBroj;

                var koord = koordinate.split(',');
                $('#xKoordinata').val(koord[0]);
                $('#yKoordinata').val(koord[1]);
                var delovi = adresaa.split(',');
                var delovi1 = delovi[0].split(' ');
                if (isNaN(delovi1[delovi1.length - 1])) {
                    for (var i = 0; i < delovi1.length; i++) {
                        ulica += delovi1[i] + " ";
                    }
                    broj = String(randomIntFromInterval(1, 20));
                }
                else {
                    for (var i = 0; i < delovi1.length - 1; i++) {
                        ulica += delovi1[i] + " ";
                    }
                    broj = delovi1[delovi1.length - 1];
                }
                var delovi2 = delovi[1].split(' ');
                if (isNaN(delovi2[delovi2.length - 1])) {
                    for (var i = 1; i < delovi2.length; i++) {
                        grad += delovi2[i] + " ";
                    }
                    postanskiBroj = "21000";
                } else if (delovi2[delovi2.length - 1] > 22000) {
                    for (var i = 1; i < delovi2.length - 1; i++) {
                        grad += delovi2[i] + " ";
                    }
                    postanskiBroj = "21000";
                }
                else {
                    for (var i = 1; i < delovi2.length - 1; i++) {
                        grad += delovi2[i] + " ";
                    }
                    postanskiBroj = delovi2[delovi2.length - 1];
                }

                $('input[name="ulica"]').val(ulica.trim());
                $('input[name="broj"]').val(parseInt(broj.trim()));
                $('input[name="grad"]').val(grad.trim());
                $('input[name="postanskiBroj"]').val(parseInt(postanskiBroj.trim()));
     
                $('input[name="iznos"]').val($('input[name="iznos2"]').val());
                $('#btnCommentPost').trigger('click');
            });
            $('body').on('click', "input[name='BbtnPreuzmi']", function (data) {
                id = data.target.id;
                $.ajax({
                    url: '/api/voznje/preuzmi/' + id,
                    method: 'GET',
                    headers: {
                        'Authorization': 'Bearer ' + localStorage.getItem("accessToken")
                    },
                    success: function (data) {

                        $('#btnRefreshStart').trigger('click');
                        $('#successContent').text('Voznja Uspesno Preuzeta!')
                        $('#successModal').modal('show');
                       
                    },
                });

            });

        });
    </script>
</head>
<body style="padding-top:20px">

    <div id="Buttons&Data" style="text-align:center" class="col-md-12 ">
        <div id="buttons" class="well">
            <div class="pull-right">
                <input id="btnLogoff" class="btn btn-success" type="button" value="Odjava" />
                <p style="text-align:center" id="username"></p>
            </div>
            <div id="Sortiranje" class="Btn-success Btn " style="display:inline-block;padding-top:13px;padding-bottom:8px">
                <label>Sortiranje</label>
                <label class="checkbox-inline"><input type="checkbox" id="datum" value="datum">Datum</label>
                <label class="checkbox-inline"><input type="checkbox" id="ocena" value="ocena">Ocena</label>
            </div>
            <div id="Datum" class="Btn Btn-success " style="display:inline-block;">

                <div style="display:inline-block">
                    <label for="date">Datum</label>
                    <input type="date" id="Dstart" class="Btn Btn-success" name="search" value="2018-06-01" min="2018-01-01" max="2018-12-31" />
                    <input type="date" id="Dend" class="Btn Btn-success" name="search" value="2018-06-28" min="2018-01-01" max="2018-12-31" />
                </div>
            </div>
            <div id="Ocena" class="Btn Btn-success " style="display:inline-block;padding-top:7px">
                <div style="display:inline-block">
                    <label for="date">Ocena</label>
                    <select style="width:70px;display:inline-block" class="form-control btn btn-success" id="Ostart">
                        <option selected value="0">0</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                    </select>
                    <select style="width:70px;display:inline-block" class="form-control btn btn-success" id="Oend">
                        <option value="0">0</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option selected value="5">5</option>
                    </select>
                </div>
            </div>
            <div id="Cena" class="Btn Btn-success " style="display:inline-block;padding-bottom:8px;padding-top:7px">
                <div style="display:inline-block">
                    <label for="date">Cena</label>
                    <input type="number" class="Btn Btn-success" id="Cstart" style="width:70px" ;name="name" value="0" min="0" />
                    <input type="number" class="Btn Btn-success" id="Cend" style="width:70px;" name="name" value="2000" min="0" />
                </div>
            </div>
            <br /><br />

            <input id="btnEditStart" class="btn btn-success" type="button" value="Izmeni Podatke" />
            <input id="btnDetailsStart" class="btn btn-success" type="button" value="Korisnicki Podaci" />
            <input id="btnLocationStart" class="btn btn-success" type="button" value="Promeni Lokaciju" />
            <input id="btnChangePasswordStart" class="btn btn-success" type="button" value="Promena Lozinke" />
            <input id="btnRefreshStart" class="btn btn-success" type="button" value="Osvezi Voznje" />
            <div id="Izbor" class="Btn-success Btn " style="display:inline-block;">
                <label class="radio-inline"><input type="radio" id="view" checked value="1" name="view">Moje</label>
                <label class="radio-inline"><input type="radio" id="view" value="-1" name="view">Na Cekanju</label>
            </div>
            <select style="width:140px;display:inline-block" class="form-control btn btn-success" id="statusVoznje">
                <option value="-1">Status Voznje</option>
                <option value="0">Kreirana</option>
                <option value="1">Formirana</option>
                <option value="2">Obradjena</option>
                <option value="3">Prihvacena</option>
                <option value="4">Otkazana</option>
                <option value="5">Neuspesna</option>
                <option value="6">Uspesna</option>
            </select>

        </div>
        <div id="divData" class="well hidden">
            <table class="table table-bordered table-responsive-md" id="tblData">
                <thead>
                    <tr class="success">
                        <td>#</td>
                        <td>Polaziste</td>
                        <td>Odrediste</td>
                        <td>Korisnik</td>
                        <td>Dispecer</td>
                        <td>Status Voznje</td>
                        <td>Datum I Vreme</td>
                        <td>Ocena</td>
                        <td>Iznos</td>
                        <td>Opcije</td>
                    </tr>
                </thead>
                <tbody id="tblBody"></tbody>
            </table>
        </div>

        <div id="divError" class="alert alert-danger collapse">
            <a id="linkClose" href="#" class="close">&times;</a>
            <div id="divErrorText"></div>
        </div>
    </div>

    <div class="modal fade" tabindex="-1" id="errorModal"
         data-keyboard="false" data-backdrop="static">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        &times;
                    </button>
                    <h4 class="modal-title">Greska</h4>
                </div>
                <div class="modal-body">
                    <form>
                        <h4 id="errorContent" class="modal-title"></h4>
                    </form>
                </div>
                <div class="modal-footer">
                    <button id="bntError" type="button" class="btn btn-danger" data-dismiss="modal">
                        Zatvori
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" tabindex="-1" id="successModal"
         data-keyboard="false" data-backdrop="static">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        &times;
                    </button>
                    <h4 class="modal-title">Uspeh</h4>
                </div>
                <div class="modal-body">
                    <form>
                        <h2 id="successContent" class="modal-title"></h2>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success" data-dismiss="modal">
                        Zatvori
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" tabindex="-1" id="EditModal" data-keyboard="false" data-backdrop="static">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        &times;
                    </button>
                    <h4 class="modal-title">Promena Korisnickih Podataka</h4>
                </div>
                <div class="modal-body">
                    <form id="editForm">
                        <div class="modal-content">
                            <table class="table table-bordered">
                                <thead>
                                    <tr class="success">
                                        <th colspan="2">
                                            Trenutni Podaci
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Ime</td>
                                        <td><input type="text" required id="ime" placeholder="Ime" /> </td>
                                    </tr>
                                    <tr>
                                        <td>Prezime</td>
                                        <td><input type="text" required id="prezime" placeholder="Prezime" /> </td>
                                    </tr>
                                    <tr>
                                        <td>Kontakt Telefon</td>
                                        <td><input type="text" required id="kontaktTelefon" placeholder="Kontakt Telefon" /> </td>
                                    </tr>
                                    <tr>
                                        <td>Email</td>
                                        <td><input type="text" required id="email" placeholder="Email" /> </td>
                                    </tr>
                                    <tr>
                                        <td>Broj Taksi Vozila</td>
                                        <td><input type="text" disabled id="brojTaksiVozila" placeholder="Broj Taksi Vozila" /> </td>
                                    </tr>
                                    <tr>
                                        <td>Godiste Automobila</td>
                                        <td><input type="number" id="godisteAutomobila" required placeholder="Godiste Automobila" /> </td>
                                    </tr>
                                    <tr>
                                        <td>Tip Automobila</td>
                                        <td>
                                            <input type="radio" id="EtipAutomobila" name="tipAutomobila" checked="checked" value="PutnickiAutomobil" />
                                            <label for="PutnickiAutomobil">Puticnki Automobil</label>

                                            <input type="radio" id="EtipAutomobila" name="tipAutomobila" value="KombiVozilo" />
                                            <label for="KombiVozilo">Kombi Vozilo</label>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Broj Registarske Oznake</td>
                                        <td><input type="text" id="brojRegistarskeOznake" required placeholder="Broj Registarske Oznake" /> </td>
                                    </tr>
                                    <tr class="success">
                                        <td colspan="2">
                                            <input id="btnEdit" class="btn btn-success" type="button" value="Promeni" />
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success" data-dismiss="modal">
                        Zatvori
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" tabindex="-1" id="DetailsModal" data-keyboard="false" data-backdrop="static">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        &times;
                    </button>
                    <h4 class="modal-title">Korisnicki Podaci</h4>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="modal-content">
                            <table class="table table-bordered">
                                <thead>
                                    <tr class="success">
                                        <th colspan="2">
                                            Detalji Vozaca
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Korisnicko Ime</td>
                                        <td><p id="pKorisnickoIme"></p></td>
                                    </tr>
                                    <tr>
                                        <td>Ime</td>
                                        <td><p id="pIme"></p></td>
                                    </tr>
                                    <tr>
                                        <td>Prezime</td>
                                        <td><p id="pPrezime"></p></td>
                                    </tr>
                                    <tr>
                                        <td>Pol</td>
                                        <td><p id="pPol"></p></td>
                                    </tr>
                                    <tr>
                                        <td>Uloga</td>
                                        <td><p id="pUloga"></p></td>
                                    </tr>
                                    <tr>
                                        <td>JMBG</td>
                                        <td><p id="pJmbg"></p></td>
                                    </tr>
                                    <tr>
                                        <td>Kontakt Telefon</td>
                                        <td><p id="pKontaktTelefon"></p></td>
                                    </tr>
                                    <tr>
                                        <td>Email</td>
                                        <td><p id="pEmail"></p></td>
                                    </tr>
                                    <tr>
                                        <td>Lozinka</td>
                                        <td><p id="pLozinka"></p></td>
                                    </tr>

                                    <tr>
                                        <td>Broj Taksi Vozila</td>
                                        <td><p id="pBrojTaksiVozila"></p> </td>
                                    </tr>
                                    <tr>
                                        <td>Godiste Automobila</td>
                                        <td><p id="pGodisteAutomobila"></p></td>
                                    </tr>
                                    <tr>
                                        <td>Tip Automobila</td>
                                        <td><p id="pTipAutomobila"></p></td>
                                    </tr>
                                    <tr>
                                        <td>Broj Registarske Oznake</td>
                                        <td><p id="pBrojRegistarskeOznake"></p></td>
                                    </tr>

                                    <tr>
                                        <td>X Koordinata</td>
                                        <td><p id="pXKoordinata"></p></td>
                                    </tr>

                                    <tr>
                                        <td>Y Koordinata</td>
                                        <td><p id="pYKoordinata"></p></td>
                                    </tr>

                                    <tr>
                                        <td>Ulica</td>
                                        <td><p id="pUlica"></p></td>
                                    </tr>

                                    <tr>
                                        <td>Broj</td>
                                        <td><p id="pBroj"></p></td>
                                    </tr>

                                    <tr>
                                        <td>Grad</td>
                                        <td><p id="pGrad"></p></td>
                                    </tr>

                                    <tr>
                                        <td>Postanski Broj</td>
                                        <td><p id="pPostanskiBroj"></p></td>
                                    </tr>

                                </tbody>
                            </table>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success" data-dismiss="modal">
                        Zatvori
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" tabindex="-1" id="LocationModal"
         data-keyboard="false" data-backdrop="static">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        &times;
                    </button>
                    <h4 class="modal-title">Promena Lokacije</h4>
                </div>
                <div class="modal-body">
                    <form id="locationForm">
                        <div class="modal-content">
                            <table class="table table-bordered">
                                <thead>
                                    <tr class="success">
                                        <th colspan="2">
                                            Trenutna Lokacija&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                            <input type="radio" name="LtipUnosa" value="Unos Adrese" id="LunosAdrese">
                                            <label for="PutnickoVozilo">Unos Adrese</label>
                                            &nbsp;&nbsp;&nbsp;
                                            <input type="radio" name="LtipUnosa" checked="checked" value="Unos lokacije" id="LunosLokacije">
                                            <label for="KombiVozilo">Trenutna Lokacija</label>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody id="UnosAdrese">
                                    <tr hidden>
                                        <td>X Koordinata</td>
                                        <td><input type="text" required id="xKoordinata" placeholder="X Koordinata" value="-1" /></td>
                                    </tr>
                                    <tr hidden>
                                        <td>Y Koordinata</td>
                                        <td><input type="text" required id="yKoordinata" placeholder="Y Koordinata" value="-1" /></td>
                                    </tr>
                                    <tr>
                                        <td>Ulica</td>
                                        <td><input type="text" required id="ulica" placeholder="Ulica" /></td>
                                    </tr>
                                    <tr>
                                        <td>Broj</td>
                                        <td><input type="number" required id="broj" placeholder="Broj" /></td>
                                    </tr>
                                    <tr>
                                        <td>Grad</td>
                                        <td><input type="text" required id="grad" placeholder="Grad" /></td>
                                    </tr>
                                    <tr>
                                        <td>Postanski Broj</td>
                                        <td><input type="number" required id="postanskiBroj" placeholder="Postanski Broj" /></td>
                                    </tr>
                                    <tr class="success">
                                        <td colspan="2">
                                            <input id="btnLocation" class="btn btn-success" type="button" value="Promeni" />
                                        </td>
                                    </tr>
                                </tbody>
                                <tbody id="UnosLokacije">
                                    <tr>
                                        <td colspan="2" id="premape">
                                            <div id="mapCanvas2"></div>
                                            <div id="infoPanel2">
                                                <b hidden>Current position:</b>
                                                <div hidden id="info2"></div>
                                                <b>Najbliza Adresa:</b>
                                                <div id="address2">
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr class="success">
                                        <td colspan="2">
                                            <input id="btnLocation2" class="btn btn-success" type="button" value="Promeni" />
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success" data-dismiss="modal">
                        Zatvori
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" tabindex="-1" id="VoznjaDetailsModel" data-keyboard="false" data-backdrop="static">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        &times;
                    </button>
                    <h4 class="modal-title">Detalji</h4>
                </div>
                <div class="modal-body">
                    <form id="orderForm">
                        <div class="modal-content">
                            <table class="table table-bordered">
                                <thead>
                                    <tr class="success">
                                        <th colspan="2">
                                            Detalji Voznje
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Dolaziste</td>
                                        <td><input type="text" id="Dadresa1" style="min-width: 70%" disabled /></td>
                                    </tr>
                                    <tr>
                                        <td>Odrediste</td>
                                        <td><input type="text" disabled style="min-width: 70%" id="Dadresa2" /></td>
                                    </tr>
                                    <tr>
                                        <td>Tip Automobila</td>
                                        <td><input type="text" disabled id="DtipAutomobila" /></td>
                                    </tr>
                                    <tr>
                                        <td>Status Voznje</td>
                                        <td><input type="text" disabled id="DstatusVoznje" /></td>
                                    </tr>
                                    <tr>
                                        <td>Broj Taksija</td>
                                        <td><input type="text" disabled id="DbrojTaksija" /></td>
                                    </tr>
                                    <tr>
                                        <td>Korisnicko ime musterije</td>
                                        <td><input type="text" disabled id="DkorisnickoIme" /></td>
                                    </tr>
                                    <tr>
                                        <td>Iznos</td>
                                        <td><input type="text" disabled id="Diznos" /></td>
                                    </tr>
                                    <tr>
                                        <td>Opis</td>
                                        <td><textarea id="Dopis" name="opis" disabled class="form-control" style="min-width: 100%;min-height:150px"></textarea></td>

                                    </tr>
                                    <tr>
                                        <td>Ocena</td>
                                        <td><input type="text" disabled id="Docena" /></td>
                                    </tr>
                                    <tr>
                                        <td>Datum Objave</td>
                                        <td><input type="text" disabled id="dVreme" /></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success" data-dismiss="modal">
                        Zatvori
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" tabindex="-1" id="PostKomentarModal" data-keyboard="false" data-backdrop="static">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        &times;
                    </button>
                    <h4 class="modal-title">Postavite Komentar</h4>
                </div>
                <div class="modal-body">
                    <form id="orderForm">
                        <div class="modal-content">
                            <table class="table table-bordered">
                                <thead>
                                    <tr class="success">
                                        <th colspan="2">
                                            Unesite informacije za postavljanje komentara&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                            <input type="radio" name="tipUnosa" value="Unos Adrese" id="unosAdrese">
                                            <label id="LabelUnosVoznje" for="PutnickoVozilo">Unos Adrese</label>
                                            &nbsp;&nbsp;&nbsp;
                                            <input type="radio" name="tipUnosa" checked="checked" value="Unos lokacije" id="unosLokacije">
                                            <label id="LabelUnosLokacije" for="KombiVozilo">Unos Lokacije</label>
                                            <input type="text" value="-1" id="xKoordinata" hidden>
                                            <input type="text" value="-1" id="yKoordinata" hidden>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody id="KomentarBody"></tbody>
                                <tbody id="LokacijaBody">
                                    <tr>
                                        <td colspan="2">
                                            <div id="mapCanvas"></div>
                                            <div id="infoPanel">
                                                <b hidden>Current position:</b>
                                                <div hidden id="info"></div>
                                                <b>Najbliza Adresa:</b>
                                                <div id="address">
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td> Iznos</td>
                                        <td> <input type="number" id="iznos2" name="iznos2" placeholder="Iznos" /></td>
                                    </tr>
                                    <tr class="success">
                                        <td colspan="2"><input id="btnCommentPost2" class="btn btn-success" type="button" value="Postavi" /></td>
                                    </tr>
                                </tbody>

                            </table>
                        </div>
                    </form>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success" data-dismiss="modal">
                        Zatvori
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" tabindex="-1" id="changePasswordModal" data-keyboard="false" data-backdrop="static">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        &times;
                    </button>
                    <h4 class="modal-title">Promeni Lozinku</h4>
                </div>
                <div class="modal-body">
                    <form id="change_Form">
                        <div class="modal-content">
                            <table class="table table-bordered">
                                <thead>
                                    <tr class="success">
                                        <th colspan="2">
                                            Unesite podatke za promenu lozinke
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Trenutna Lozinka</td>
                                        <td><input type="password" required id="lozinka1" placeholder="Trenutna Lozinka" /></td>
                                    </tr>
                                    <tr>
                                        <td>Nova Lozinka</td>
                                        <td><input type="text" required id="lozinka2" placeholder="Nova Lozinka" /></td>
                                    </tr>
                                    <tr>
                                        <td>Potvrda Nove Lozinke</td>
                                        <td><input type="password" required id="lozinka3" placeholder="Potvrda Nove Lozinke" /></td>
                                    </tr>

                                    <tr class="success">
                                        <td colspan="2">
                                            <input id="btnChangePassword" class="btn btn-success" type="button" value="Promeni" />
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success" data-dismiss="modal">
                        Zatvori
                    </button>
                </div>
            </div>
        </div>
    </div>

    <footer id="footer" style="width:100%;height:40px;vertical-align:central;position:fixed;bottom:0; left:0;" class="Btn Btn-success">
        <p style="font-size:14px;float:left;vertical-align:bottom"><b>Taxi Aplikacija</b></p>
        <p style="font-size:14px;float:right"><b>&copy&nbsp2018 Stefan Ruvceski</b></p>
    </footer>
</body>
</html>